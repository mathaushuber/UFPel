USE app_adocao;
#--------------------------------------------------------------------------------------------------------------
# Nome dos protetores e seus pets
#--------------------------------------------------------------------------------------------------------------
SELECT firstName, name  FROM usuario as u JOIN pet WHERE protectorId = u.id;
#--------------------------------------------------------------------------------------------------------------

#--------------------------------------------------------------------------------------------------------------
# Quantidade de pet por protetor
#--------------------------------------------------------------------------------------------------------------
SELECT firstName, lastName, COUNT(p.id) FROM usuario as u JOIN pet as p 
WHERE protectorId = u.id GROUP BY p.id;
#--------------------------------------------------------------------------------------------------------------------------------

#--------------------------------------------------------------------------------------------------------------------------------
# Nome dos adotantes e seus pets adotados
#--------------------------------------------------------------------------------------------------------------------------------
SELECT firstName, name  FROM usuario as u JOIN pet as p JOIN adocao WHERE adopterId = u.id AND petId = p.id;
#--------------------------------------------------------------------------------------------------------------------------------

#--------------------------------------------------------------------------------------------------------------------------------
# Numero de pets adotados por adotante
#--------------------------------------------------------------------------------------------------------------------------------
SELECT firstName, lastName, COUNT(p.id) FROM usuario as u JOIN pet as p JOIN adocao 
WHERE adopterId = u.id AND petId = p.id GROUP BY u.id;
#--------------------------------------------------------------------------------------------------------------------------------

#--------------------------------------------------------------------------------------------------------------------------------
# Nome dos usuarios e cada um de seus endereços
#--------------------------------------------------------------------------------------------------------------------------------
SELECT firstName, lastName, l.* FROM localizacao AS l JOIN localizacoes JOIN usuario AS u 
WHERE idLocalizacao = l.id AND idUsuario = u.id GROUP BY idUsuario, idLocalizacao;
#--------------------------------------------------------------------------------------------------------------------------------

#--------------------------------------------------------------------------------------------------------------------------------
# Quantidade de endereços que cada usuario tem cadastrados
#--------------------------------------------------------------------------------------------------------------------------------
SELECT firstName, lastName, COUNT(l.id) FROM localizacao AS l JOIN localizacoes JOIN usuario AS u 
WHERE idLocalizacao = l.id AND idUsuario = u.id GROUP BY u.id;
#--------------------------------------------------------------------------------------------------------------------------------

#--------------------------------------------------------------------------------------------------------------------------------
# Nome de cada usuario cadastrado e se é adotande, protetor e admin
#---------------------------------------------------------------------------------------------------------------------------------
SELECT firstName, lastName, IF(MAX(IF (adopterId = u.id, 1, 0)) = 1, 'YES', 'NO') AS isAdopter,
IF(MAX(IF (protectorId = u.id, 1, 0)) = 1, 'YES', 'NO') AS isProtector, 
IF(isAdmin=1, 'YES', 'NO') AS isAdmin FROM pet JOIN usuario AS u JOIN adocao GROUP BY u.id;
#--------------------------------------------------------------------------------------------------------------------------------